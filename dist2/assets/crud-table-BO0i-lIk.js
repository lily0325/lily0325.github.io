import{_ as V}from"./index.vue_vue_type_script_setup_true_lang-hu36eVm9.js";import{aV as B,I as U,E as $,ae as D,K as z,bd as E,bh as R,a9 as K,a4 as N,H,S as j,a5 as G,a3 as J,b8 as L,ay as W}from"./antd-DS5P5d4E.js";import{d as M,f as x,c as X,a2 as Q,ab as T,ac as n,k as e,u as t,H as Y,r as Z,o as ee,s as ae,G as b,a3 as ne,ag as te}from"./vue-CUuKurUo.js";import{s as oe,t as le,u as re,_ as ue}from"./index-BwT0Twmy.js";import"./context-CCfJ8z80.js";const se=M({__name:"crud-table-modal",emits:["cancel","ok"],setup(f,{expose:a,emit:_}){const l=_,v=x(!1),o=x(!1),d=X(()=>v.value?"编辑":"新增"),y=x(),m=x({name:"",value:""}),q={style:{width:"100px"}},h={span:24};function c(r){o.value=!0,v.value=!!(r!=null&&r.id),m.value=B(r)??{name:"",value:""}}async function i(){var r;try{await((r=y.value)==null?void 0:r.validate()),l("ok"),o.value=!1}catch(u){console.log("Form Validate Failed:",u)}}function k(){var r;(r=y.value)==null||r.resetFields(),l("cancel")}return a({open:c}),(r,u)=>{const g=U,w=$,S=D,P=z,C=E;return Q(),T(C,{open:t(o),"onUpdate:open":u[3]||(u[3]=p=>Y(o)?o.value=p:null),title:t(d),onOk:i,onCancel:k},{default:n(()=>[e(P,{ref_key:"formRef",ref:y,model:t(m),class:"w-full","label-col":q,"wrapper-col":h},{default:n(()=>[e(w,{name:"name",label:"名",rules:[{required:!0,message:"请输入名"}]},{default:n(()=>[e(g,{value:t(m).name,"onUpdate:value":u[0]||(u[0]=p=>t(m).name=p),maxlength:50,placeholder:"请输入名"},null,8,["value"])]),_:1}),e(w,{name:"value",label:"值",rules:[{required:!0,message:"请输入值"}]},{default:n(()=>[e(g,{value:t(m).value,"onUpdate:value":u[1]||(u[1]=p=>t(m).value=p),maxlength:50,placeholder:"请输入值"},null,8,["value"])]),_:1}),e(w,{name:"remark",label:"备注"},{default:n(()=>[e(S,{value:t(m).remark,"onUpdate:value":u[2]||(u[2]=p=>t(m).remark=p),"show-count":"",maxlength:200,placeholder:"请输入备注"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])}}});async function ie(f){return oe("/list/crud-table",f)}async function ce(f){return le(`/list/${f}`)}function de(f){const a=Z(R({queryApi:()=>Promise.resolve(),loading:!1,queryParams:{},dataSource:[],rowSelections:{selectedRowKeys:[],selectedRows:[],onChange(o,d){a.rowSelections.selectedRowKeys=o,a.rowSelections.selectedRows=d}},queryOnMounted:!0,pagination:R({pageSize:10,pageSizeOptions:["10","20","30","40"],current:1,total:0,order:"desc",column:"createTime",showSizeChanger:!0,showQuickJumper:!0,showTotal:o=>`总数据位：${o}`,onChange(o,d){a.pagination.pageSize=d,a.pagination.current=o,_()}},f.pagination),expand:!1,expandChange(){a.expand=!a.expand},beforeQuery(){},afterQuery(o){return o}},f));async function _(){if(!a.loading){a.loading=!0;try{await a.beforeQuery();const{data:o}=await a.queryApi({current:a.pagination.current,pageSize:a.pagination.pageSize,column:a.pagination.column,order:a.pagination.order,...a.queryParams});if(o){const d=await a.afterQuery(o);a.dataSource=d.records??[],a.pagination.total=d.total??0}}catch(o){throw new Error(`Query Failed: ${o}`)}finally{a.loading=!1}}}function l(){a.pagination.current=1,a.queryParams={},_()}function v(){a.pagination.current=1,_()}return ee(()=>{a.queryOnMounted&&_()}),{query:_,resetQuery:l,initQuery:v,state:a}}const me={key:0,flex:"","gap-2":""},_e=M({__name:"crud-table",setup(f){const a=re(),_=ae([{title:"名",dataIndex:"name"},{title:"值",dataIndex:"value"},{title:"描述",dataIndex:"remark"},{title:"操作",dataIndex:"action"}]),{state:l,initQuery:v,resetQuery:o,query:d}=de({queryApi:ie,queryParams:{name:void 0,value:void 0,remark:void 0},afterQuery:c=>(console.log(c),c)}),y=x();async function m(c){if(!c.id)return a.error("id 不能为空");try{(await ce(c.id)).code===200&&await d(),a.success("删除成功")}catch(i){console.log(i)}finally{close()}}function q(){var c;(c=y.value)==null||c.open()}function h(c){var i;(i=y.value)==null||i.open(c)}return(c,i)=>{const k=U,r=$,u=N,g=H,w=j,S=G,P=z,C=J,p=L,A=W,O=V;return Q(),T(O,null,{default:n(()=>[e(C,{"mb-4":""},{default:n(()=>[e(P,{class:"system-crud-wrapper","label-col":{span:7},model:t(l).queryParams},{default:n(()=>[e(S,{gutter:[15,0]},{default:n(()=>[e(u,{span:6},{default:n(()=>[e(r,{name:"name",label:"名"},{default:n(()=>[e(k,{value:t(l).queryParams.name,"onUpdate:value":i[0]||(i[0]=s=>t(l).queryParams.name=s),placeholder:"请输入名"},null,8,["value"])]),_:1})]),_:1}),e(u,{span:6},{default:n(()=>[e(r,{name:"value",label:"值"},{default:n(()=>[e(k,{value:t(l).queryParams.value,"onUpdate:value":i[1]||(i[1]=s=>t(l).queryParams.value=s),placeholder:"请输入值"},null,8,["value"])]),_:1})]),_:1}),e(u,{span:6},{default:n(()=>[e(r,{name:"remark",label:"备注"},{default:n(()=>[e(k,{value:t(l).queryParams.remark,"onUpdate:value":i[2]||(i[2]=s=>t(l).queryParams.remark=s),placeholder:"请输入备注"},null,8,["value"])]),_:1})]),_:1}),e(u,{span:6},{default:n(()=>[e(w,{flex:"","justify-end":"","w-full":""},{default:n(()=>[e(g,{loading:t(l).loading,type:"primary",onClick:t(v)},{default:n(()=>[b(" 查询 ")]),_:1},8,["loading","onClick"]),e(g,{loading:t(l).loading,onClick:t(o)},{default:n(()=>[b(" 重置 ")]),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(C,{title:"增删改查表格"},{extra:n(()=>[e(w,{size:"middle"},{default:n(()=>[e(g,{type:"primary",onClick:q},{icon:n(()=>[e(t(K))]),default:n(()=>[b(" 新增 ")]),_:1})]),_:1})]),default:n(()=>[e(A,{"row-key":"id","row-selection":t(l).rowSelections,loading:t(l).loading,columns:t(_),"data-source":t(l).dataSource,pagination:t(l).pagination},{bodyCell:n(s=>{var I;return[((I=s==null?void 0:s.column)==null?void 0:I.dataIndex)==="action"?(Q(),ne("div",me,[e(g,{type:"link",onClick:F=>h(s==null?void 0:s.record)},{default:n(()=>[b(" 编辑 ")]),_:2},1032,["onClick"]),e(p,{title:"确定删除该条数据？","ok-text":"确定","cancel-text":"取消",onConfirm:F=>m(s==null?void 0:s.record)},{default:n(()=>[e(g,{type:"link"},{default:n(()=>[b(" 删除 ")]),_:1})]),_:2},1032,["onConfirm"])])):te("",!0)]}),_:1},8,["row-selection","loading","columns","data-source","pagination"])]),_:1}),e(se,{ref_key:"crudTableModal",ref:y},null,512)]),_:1})}}}),we=ue(_e,[["__scopeId","data-v-cac80fed"]]);export{we as default};
